(()=>{"use strict";let e=null,t=!1;const n=document.createElement("style");function o(n){if(!t)return;const o=n.target;o!==e&&(document.querySelectorAll(".ucolor-hover").forEach((e=>e.classList.remove("ucolor-hover"))),o.classList.add("ucolor-hover"))}function r(e){t&&e.target.classList.remove("ucolor-hover")}function i(e){const t=window.getComputedStyle(e),n=t.background,o=t.backgroundColor;if(n.includes("gradient")){const e=n.match(/linear-gradient\(((?:\d+)(?:deg))?,\s*((?:rgb\([^)]+\)|#[a-fA-F0-9]{6}|[a-zA-Z]+)),\s*((?:rgb\([^)]+\)|#[a-fA-F0-9]{6}|[a-zA-Z]+))\)/);if(e){const[,t,n,o]=e;return{color:`linear-gradient(${t||"90deg"}, ${n.trim()}, ${o.trim()})`,isGradient:!0}}}return{color:o,isGradient:!1}}n.textContent="\n  .ucolor-hover {\n    outline: 2px dashed #4CAF50 !important;\n    outline-offset: 2px !important;\n  }\n",document.head.appendChild(n);const a={stable:70,standard:40,experimental:25,aggressive:15};function s(e){return e.trim().replace(/\s+/g," ").toLowerCase()}function c(e){return e instanceof HTMLButtonElement?"button":e instanceof HTMLInputElement?`input-${e.type}`:e instanceof HTMLAnchorElement?"link":e.getAttribute("role")?`role-${e.getAttribute("role")}`:"none"}function l(e){const t=window.getComputedStyle(e);return!!(e.onclick||"button"===e.getAttribute("role")||e instanceof HTMLButtonElement||e instanceof HTMLAnchorElement||"pointer"===t.cursor)}function d(e){const t=e.getBoundingClientRect(),n=e.parentElement,o={textContent:s(e.textContent||""),tagName:e.tagName.toLowerCase(),href:e instanceof HTMLAnchorElement?e.href:void 0,src:e instanceof HTMLImageElement?e.src:void 0,alt:e instanceof HTMLImageElement?e.alt:void 0,ariaLabel:e.getAttribute("aria-label")||void 0,role:e.getAttribute("role")||void 0,dimensions:{width:Math.round(t.width),height:Math.round(t.height),x:Math.round(t.x),y:Math.round(t.y)},parentText:n?s(n.textContent||""):"",classes:Array.from(e.classList),persistenceMode:e.getAttribute("data-ucolor-persistence")||"standard"};return"aggressive"===o.persistenceMode&&(o.viewportPosition=function(e){const t=e.getBoundingClientRect();return{isInViewport:t.top>=0&&t.top<=window.innerHeight,relativePosition:{fromTop:t.top/window.innerHeight,fromLeft:t.left/window.innerWidth}}}(e),o.visualCharacteristics=function(e){const t=window.getComputedStyle(e);return{fontSize:t.fontSize,textAlign:t.textAlign,display:t.display,isVisible:"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity}}(e),o.elementStructure=function(e){const t=e.parentElement,n=t?Array.from(t.children):[],o=n.indexOf(e);return{siblingTypes:n.map((e=>e.tagName.toLowerCase())),relativePositionInParent:n.length?o/n.length:0,inHeader:!!e.closest("header"),inFooter:!!e.closest("footer"),inNav:!!e.closest("nav"),inMain:!!e.closest("main"),inAside:!!e.closest("aside")}}(e),o.domTreeContext=function(e){var t;let n=0,o=e;for(;o.parentElement;)n++,o=o.parentElement;const r=(null===(t=e.parentElement)||void 0===t?void 0:t.children)||[],i=Array.from(r).filter((t=>t.tagName===e.tagName&&t.className===e.className)),a={};return["header","nav","main","aside","footer"].forEach((t=>{const n=e.closest(t);if(n){const o=function(e,t){let n=0,o=e;for(;o&&o!==t&&o!==document.body;)n++,o=o.parentElement;return o===t?n:1/0}(e,n);a[t]=o}})),{depthFromRoot:n,siblingCount:r.length,similarSiblingsCount:i.length,nearestLandmarks:a,childrenCount:e.children.length}}(e),o.visualLayout=function(e){const t=window.getComputedStyle(e),n=window.getComputedStyle(e.parentElement),o=e.getBoundingClientRect(),r=e.parentElement.getBoundingClientRect();return{zIndex:parseInt(t.zIndex)||0,stackingContext:"static"!==t.position||"auto"!==t.zIndex,marginPattern:`${t.marginTop}-${t.marginRight}-${t.marginBottom}-${t.marginLeft}`,paddingPattern:`${t.paddingTop}-${t.paddingRight}-${t.paddingBottom}-${t.paddingLeft}`,isInFlexContainer:n.display.includes("flex"),isInGridContainer:n.display.includes("grid"),relativeSize:{toParent:o.width*o.height/(r.width*r.height),toViewport:o.width*o.height/(window.innerWidth*window.innerHeight)},gridPosition:n.display.includes("grid")?{row:parseInt(t.gridRowStart)||0,column:parseInt(t.gridColumnStart)||0}:void 0}}(e),o.enhancedCharacteristics=function(e){const t=window.getComputedStyle(e),n=["color","backgroundColor","fontSize","fontWeight","display","position","borderRadius","boxShadow","textAlign"].map((e=>`${e}:${t.getPropertyValue(e)}`)).join(";"),o={},r={};return Array.from(e.attributes).forEach((e=>{e.name.startsWith("aria-")?o[e.name]=e.value:e.name.startsWith("data-")&&(r[e.name]=e.value)})),{computedStylesHash:n,hasEventListeners:null!==e.onclick||null!==e.onmousedown||null!==e.onmouseup,ariaAttributes:o,dataAttributes:r,interactiveType:c(e),isClickable:l(e)}}(e)),o}function u(e,t){let n=0;const o=d(t);e.textContent&&e.textContent===o.textContent?n+=40:e.textContent&&o.textContent.includes(e.textContent)?n+=20:e.textContent&&o.textContent.length>0&&("aggressive"===e.persistenceMode||"experimental"===e.persistenceMode)&&(n+=10),e.tagName===o.tagName&&(n+=15),e.href&&e.href===o.href&&(n+=5),e.src&&e.src===o.src&&(n+=5),e.alt&&e.alt===o.alt&&(n+=2),e.ariaLabel&&e.ariaLabel===o.ariaLabel&&(n+=3);const r=Math.abs(e.dimensions.width-o.dimensions.width)+Math.abs(e.dimensions.height-o.dimensions.height);r<5?n+=10:r<20?n+=5:r<50&&("aggressive"===e.persistenceMode||"experimental"===e.persistenceMode)&&(n+=3),e.parentText&&e.parentText===o.parentText?n+=10:e.parentText&&o.parentText.includes(e.parentText)&&("aggressive"===e.persistenceMode||"experimental"===e.persistenceMode)&&(n+=5);const i=e.classes.filter((e=>o.classes.includes(e)));if(n+=Math.min(10,2*i.length),"aggressive"===e.persistenceMode&&e.classes.length>0){const t=e.classes.filter((e=>o.classes.some((t=>t.includes(e)||e.includes(t)))));n+=Math.min(5,t.length)}if("aggressive"===e.persistenceMode){if(e.viewportPosition&&o.viewportPosition){const t=e.viewportPosition,r=o.viewportPosition;Math.abs(t.relativePosition.fromTop-r.relativePosition.fromTop)<.3&&Math.abs(t.relativePosition.fromLeft-r.relativePosition.fromLeft)<.3&&(n+=10)}if(e.visualCharacteristics&&o.visualCharacteristics){const t=e.visualCharacteristics,r=o.visualCharacteristics;t.fontSize===r.fontSize&&(n+=2),t.textAlign===r.textAlign&&(n+=2),t.display===r.display&&(n+=2),t.isVisible===r.isVisible&&(n+=4)}if(e.elementStructure&&o.elementStructure){const t=e.elementStructure,r=o.elementStructure;Math.abs(t.relativePositionInParent-r.relativePositionInParent)<.2&&(n+=5),(t.inHeader&&r.inHeader||t.inFooter&&r.inFooter||t.inNav&&r.inNav||t.inMain&&r.inMain||t.inAside&&r.inAside)&&(n+=5)}if(e.domTreeContext&&o.domTreeContext){const t=e.domTreeContext,r=o.domTreeContext;t.depthFromRoot===r.depthFromRoot&&(n+=2),t.siblingCount===r.siblingCount&&(n+=2),t.similarSiblingsCount===r.similarSiblingsCount&&(n+=2),t.nearestLandmarks.header===r.nearestLandmarks.header&&(n+=2),t.nearestLandmarks.nav===r.nearestLandmarks.nav&&(n+=2),t.nearestLandmarks.main===r.nearestLandmarks.main&&(n+=2),t.nearestLandmarks.aside===r.nearestLandmarks.aside&&(n+=2),t.nearestLandmarks.footer===r.nearestLandmarks.footer&&(n+=2)}if(e.visualLayout&&o.visualLayout){const t=e.visualLayout,r=o.visualLayout;t.zIndex===r.zIndex&&(n+=2),t.stackingContext===r.stackingContext&&(n+=2),t.marginPattern===r.marginPattern&&(n+=2),t.paddingPattern===r.paddingPattern&&(n+=2),t.isInFlexContainer===r.isInFlexContainer&&(n+=2),t.isInGridContainer===r.isInGridContainer&&(n+=2),t.relativeSize.toParent===r.relativeSize.toParent&&(n+=2),t.relativeSize.toViewport===r.relativeSize.toViewport&&(n+=2)}if(e.enhancedCharacteristics&&o.enhancedCharacteristics){const t=e.enhancedCharacteristics,r=o.enhancedCharacteristics;t.computedStylesHash===r.computedStylesHash&&(n+=2),t.hasEventListeners===r.hasEventListeners&&(n+=2),t.ariaAttributes.size===r.ariaAttributes.size&&(n+=2),t.dataAttributes.size===r.dataAttributes.size&&(n+=2),t.interactiveType===r.interactiveType&&(n+=2),t.isClickable===r.isClickable&&(n+=2)}}return n}function m(e){const t=Array.from(document.getElementsByTagName(e.tagName));let n=null,o=0;const r=a[e.persistenceMode||"standard"];return t.forEach((t=>{const r=u(e,t);r>o&&(o=r,n=t)})),o>=r?n:null}function g(n){if(!t)return;n.preventDefault(),n.stopPropagation(),e=n.target,document.querySelectorAll(".ucolor-hover").forEach((e=>e.classList.remove("ucolor-hover")));const a=i(e),s=d(e);chrome.runtime.sendMessage({type:"ELEMENT_SELECTED",elementInfo:{fingerprint:s,tagName:e.tagName,path:h(e),currentColor:a.color,isGradient:a.isGradient}}),t=!1,document.body.style.cursor="default",document.removeEventListener("mouseover",o),document.removeEventListener("mouseout",r),document.removeEventListener("click",g)}function h(e){const t=[];let n=e;for(;n&&n!==document.body;){let e=n.tagName.toLowerCase();n.id?e+="#"+n.id:n.className&&(e+="."+n.className.split(" ").filter((e=>"ucolor-hover"!==e)).join(".")),t.unshift(e),n=n.parentElement}return t.join(" > ")}const p=()=>window.location.origin+window.location.pathname;function f(e,t){const n=a[t.persistenceMode||"standard"];return u(t,e)>=n}chrome.runtime.onMessage.addListener(((n,a,s)=>{switch(n.type){case"START_PICKING":t=!0,document.body.style.cursor="crosshair",document.addEventListener("mouseover",o),document.addEventListener("mouseout",r),document.addEventListener("click",g),s({success:!0});break;case"APPLY_COLOR":if(e&&n.color){const t=n.isGradient?`linear-gradient(${n.color})`:n.color;e.style.background=t,e.setAttribute("data-ucolor-persistence",n.persistenceMode||"standard"),chrome.storage.local.get("colorChanges",(t=>{const o=t.colorChanges||{},r=p(),i=o[r]||[],a=d(e);a.persistenceMode=n.persistenceMode||"standard";const s={fingerprint:a,path:h(e),color:n.color,elementTag:e.tagName.toLowerCase(),timestamp:Date.now(),isGradient:n.isGradient},c=i.filter((t=>!f(e,t.fingerprint)));o[r]=[...c,s],chrome.storage.local.set({colorChanges:o})})),s({success:!0})}break;case"GET_SELECTED_ELEMENT":if(e){const t=i(e);s({hasSelected:!0,elementInfo:{tagName:e.tagName,path:h(e),currentColor:t.color,isGradient:t.isGradient}})}else s({hasSelected:!1,elementInfo:null});break;case"GET_HISTORY":chrome.storage.local.get("colorChanges",(e=>{const t=e.colorChanges||{},n=p();s({changes:t[n]||[]})}));break;case"RESET_ELEMENT":if(n.fingerprint){const e=m(n.fingerprint);e&&(e.style.background="",e.style.backgroundColor="",chrome.storage.local.get("colorChanges",(t=>{const n=t.colorChanges||{},o=p(),r=n[o]||[];n[o]=r.filter((t=>!f(e,t.fingerprint))),chrome.storage.local.set({colorChanges:n})}))),s({success:!0})}break;case"RESET_ALL":chrome.storage.local.get("colorChanges",(e=>{const t=e.colorChanges||{},n=p();(t[n]||[]).forEach((e=>{const t=document.querySelector(e.path);t&&(t.style.background="",t.style.backgroundColor="")})),delete t[n],chrome.storage.local.set({colorChanges:t}),s({success:!0})}))}return!0})),chrome.storage.local.get("colorChanges",(e=>{((e.colorChanges||{})[p()]||[]).forEach((e=>{try{let t=m(e.fingerprint);if(t||(t=document.querySelector(e.path)),t){const n=e.isGradient?`linear-gradient(${e.color})`:e.color;t.style.background=n}}catch(t){console.warn("Failed to apply color to element:",e.fingerprint.textContent)}}))}))})();
(()=>{"use strict";let e=null,t=!1,n=null;const o=document.createElement("style");function r(e){return e.startsWith("rgb")?function(e){const t=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)/i);return t?"#"+((1<<24)+(parseInt(t[1])<<16)+(parseInt(t[2])<<8)+parseInt(t[3])).toString(16).slice(1):e}(e):e}function i(n){if(!t)return;const o=n.target;o!==e&&(document.querySelectorAll(".ucolor-hover").forEach((e=>e.classList.remove("ucolor-hover"))),o.classList.add("ucolor-hover"))}function a(e){t&&e.target.classList.remove("ucolor-hover")}function s(e){const t=window.getComputedStyle(e),n=t.background,o=t.backgroundColor;if(n.includes("gradient")){const e=n.match(/linear-gradient\(((?:\d+)(?:deg))?,\s*((?:rgb\([^)]+\)|#[a-fA-F0-9]{6}|[a-zA-Z]+)),\s*((?:rgb\([^)]+\)|#[a-fA-F0-9]{6}|[a-zA-Z]+))\)/);if(e){const[,t,n,o]=e;return{color:`linear-gradient(${t||"90deg"}, ${r(n.trim())}, ${r(o.trim())})`,isGradient:!0}}}return{color:r(o),isGradient:!1}}o.textContent="\n  .ucolor-hover {\n    outline: 2px dashed #4CAF50 !important;\n    outline-offset: 2px !important;\n  }\n  .ucolor-selected {\n    outline: 3px solid #2196F3 !important;\n  }\n",document.head.appendChild(o);const c={stable:70,standard:40,experimental:25,aggressive:15};function l(){return"ucolor-"+Math.random().toString(36).substr(2,9)}function d(e){return e.trim().replace(/\s+/g," ").toLowerCase()}function u(e){return e instanceof HTMLButtonElement?"button":e instanceof HTMLInputElement?`input-${e.type}`:e instanceof HTMLAnchorElement?"link":e.getAttribute("role")?`role-${e.getAttribute("role")}`:"none"}function g(e){const t=window.getComputedStyle(e);return!!(e.onclick||"button"===e.getAttribute("role")||e instanceof HTMLButtonElement||e instanceof HTMLAnchorElement||"pointer"===t.cursor)}function m(e){const t=e.getBoundingClientRect(),n=e.parentElement,o={textContent:d(e.textContent||""),tagName:e.tagName.toLowerCase(),href:e instanceof HTMLAnchorElement?e.href:void 0,src:e instanceof HTMLImageElement?e.src:void 0,alt:e instanceof HTMLImageElement?e.alt:void 0,ariaLabel:e.getAttribute("aria-label")||void 0,role:e.getAttribute("role")||void 0,dimensions:{width:Math.round(t.width),height:Math.round(t.height),x:Math.round(t.x),y:Math.round(t.y)},parentText:n?d(n.textContent||""):"",classes:Array.from(e.classList),persistenceMode:e.getAttribute("data-ucolor-persistence")||"standard"};return"aggressive"===o.persistenceMode&&(o.viewportPosition=function(e){const t=e.getBoundingClientRect();return{isInViewport:t.top>=0&&t.top<=window.innerHeight,relativePosition:{fromTop:t.top/window.innerHeight,fromLeft:t.left/window.innerWidth}}}(e),o.visualCharacteristics=function(e){const t=window.getComputedStyle(e);return{fontSize:t.fontSize,textAlign:t.textAlign,display:t.display,isVisible:"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity}}(e),o.elementStructure=function(e){const t=e.parentElement,n=t?Array.from(t.children):[],o=n.indexOf(e);return{siblingTypes:n.map((e=>e.tagName.toLowerCase())),relativePositionInParent:n.length?o/n.length:0,inHeader:!!e.closest("header"),inFooter:!!e.closest("footer"),inNav:!!e.closest("nav"),inMain:!!e.closest("main"),inAside:!!e.closest("aside")}}(e),o.domTreeContext=function(e){var t;let n=0,o=e;for(;o.parentElement;)n++,o=o.parentElement;const r=(null===(t=e.parentElement)||void 0===t?void 0:t.children)||[],i=Array.from(r).filter((t=>t.tagName===e.tagName&&t.className===e.className)),a={};return["header","nav","main","aside","footer"].forEach((t=>{const n=e.closest(t);if(n){const o=function(e,t){let n=0,o=e;for(;o&&o!==t&&o!==document.body;)n++,o=o.parentElement;return o===t?n:1/0}(e,n);a[t]=o}})),{depthFromRoot:n,siblingCount:r.length,similarSiblingsCount:i.length,nearestLandmarks:a,childrenCount:e.children.length}}(e),o.visualLayout=function(e){const t=window.getComputedStyle(e),n=window.getComputedStyle(e.parentElement),o=e.getBoundingClientRect(),r=e.parentElement.getBoundingClientRect();return{zIndex:parseInt(t.zIndex)||0,stackingContext:"static"!==t.position||"auto"!==t.zIndex,marginPattern:`${t.marginTop}-${t.marginRight}-${t.marginBottom}-${t.marginLeft}`,paddingPattern:`${t.paddingTop}-${t.paddingRight}-${t.paddingBottom}-${t.paddingLeft}`,isInFlexContainer:n.display.includes("flex"),isInGridContainer:n.display.includes("grid"),relativeSize:{toParent:o.width*o.height/(r.width*r.height),toViewport:o.width*o.height/(window.innerWidth*window.innerHeight)},gridPosition:n.display.includes("grid")?{row:parseInt(t.gridRowStart)||0,column:parseInt(t.gridColumnStart)||0}:void 0}}(e),o.enhancedCharacteristics=function(e){const t=window.getComputedStyle(e),n=["color","backgroundColor","fontSize","fontWeight","display","position","borderRadius","boxShadow","textAlign"].map((e=>`${e}:${t.getPropertyValue(e)}`)).join(";"),o={},r={};return Array.from(e.attributes).forEach((e=>{e.name.startsWith("aria-")?o[e.name]=e.value:e.name.startsWith("data-")&&(r[e.name]=e.value)})),{computedStylesHash:n,hasEventListeners:null!==e.onclick||null!==e.onmousedown||null!==e.onmouseup,ariaAttributes:o,dataAttributes:r,interactiveType:u(e),isClickable:g(e)}}(e)),o}function h(e,t){let n=0;const o=m(t);e.textContent&&e.textContent===o.textContent?n+=40:e.textContent&&o.textContent.includes(e.textContent)?n+=20:e.textContent&&o.textContent.length>0&&("aggressive"===e.persistenceMode||"experimental"===e.persistenceMode)&&(n+=10),e.tagName===o.tagName&&(n+=15),e.href&&e.href===o.href&&(n+=5),e.src&&e.src===o.src&&(n+=5),e.alt&&e.alt===o.alt&&(n+=2),e.ariaLabel&&e.ariaLabel===o.ariaLabel&&(n+=3);const r=Math.abs(e.dimensions.width-o.dimensions.width)+Math.abs(e.dimensions.height-o.dimensions.height);r<5?n+=10:r<20?n+=5:r<50&&("aggressive"===e.persistenceMode||"experimental"===e.persistenceMode)&&(n+=3),e.parentText&&e.parentText===o.parentText?n+=10:e.parentText&&o.parentText.includes(e.parentText)&&("aggressive"===e.persistenceMode||"experimental"===e.persistenceMode)&&(n+=5);const i=e.classes.filter((e=>o.classes.includes(e)));if(n+=Math.min(10,2*i.length),"aggressive"===e.persistenceMode&&e.classes.length>0){const t=e.classes.filter((e=>o.classes.some((t=>t.includes(e)||e.includes(t)))));n+=Math.min(5,t.length)}if("aggressive"===e.persistenceMode){if(e.viewportPosition&&o.viewportPosition){const t=e.viewportPosition,r=o.viewportPosition;Math.abs(t.relativePosition.fromTop-r.relativePosition.fromTop)<.3&&Math.abs(t.relativePosition.fromLeft-r.relativePosition.fromLeft)<.3&&(n+=10)}if(e.visualCharacteristics&&o.visualCharacteristics){const t=e.visualCharacteristics,r=o.visualCharacteristics;t.fontSize===r.fontSize&&(n+=2),t.textAlign===r.textAlign&&(n+=2),t.display===r.display&&(n+=2),t.isVisible===r.isVisible&&(n+=4)}if(e.elementStructure&&o.elementStructure){const t=e.elementStructure,r=o.elementStructure;Math.abs(t.relativePositionInParent-r.relativePositionInParent)<.2&&(n+=5),(t.inHeader&&r.inHeader||t.inFooter&&r.inFooter||t.inNav&&r.inNav||t.inMain&&r.inMain||t.inAside&&r.inAside)&&(n+=5)}if(e.domTreeContext&&o.domTreeContext){const t=e.domTreeContext,r=o.domTreeContext;t.depthFromRoot===r.depthFromRoot&&(n+=2),t.siblingCount===r.siblingCount&&(n+=2),t.similarSiblingsCount===r.similarSiblingsCount&&(n+=2),t.nearestLandmarks.header===r.nearestLandmarks.header&&(n+=2),t.nearestLandmarks.nav===r.nearestLandmarks.nav&&(n+=2),t.nearestLandmarks.main===r.nearestLandmarks.main&&(n+=2),t.nearestLandmarks.aside===r.nearestLandmarks.aside&&(n+=2),t.nearestLandmarks.footer===r.nearestLandmarks.footer&&(n+=2)}if(e.visualLayout&&o.visualLayout){const t=e.visualLayout,r=o.visualLayout;t.zIndex===r.zIndex&&(n+=2),t.stackingContext===r.stackingContext&&(n+=2),t.marginPattern===r.marginPattern&&(n+=2),t.paddingPattern===r.paddingPattern&&(n+=2),t.isInFlexContainer===r.isInFlexContainer&&(n+=2),t.isInGridContainer===r.isInGridContainer&&(n+=2),t.relativeSize.toParent===r.relativeSize.toParent&&(n+=2),t.relativeSize.toViewport===r.relativeSize.toViewport&&(n+=2)}if(e.enhancedCharacteristics&&o.enhancedCharacteristics){const t=e.enhancedCharacteristics,r=o.enhancedCharacteristics;t.computedStylesHash===r.computedStylesHash&&(n+=2),t.hasEventListeners===r.hasEventListeners&&(n+=2),t.ariaAttributes.size===r.ariaAttributes.size&&(n+=2),t.dataAttributes.size===r.dataAttributes.size&&(n+=2),t.interactiveType===r.interactiveType&&(n+=2),t.isClickable===r.isClickable&&(n+=2)}}return n}function p(e){const t=Array.from(document.getElementsByTagName(e.tagName));let n=null,o=0;const r=c[e.persistenceMode||"standard"];return t.forEach((t=>{const r=h(e,t);r>o&&(o=r,n=t)})),o>=r?n:null}const f=function(e){let t;return function(...n){clearTimeout(t),t=setTimeout((()=>{clearTimeout(t),e(...n)}),250)}}(v);function C(){n&&n.disconnect(),n=new MutationObserver((e=>{let t=!1;for(const n of e)if("attributes"===n.type){if(n.target.hasAttribute("data-ucolor-uid")){t=!0;break}}else if("childList"===n.type&&n.addedNodes.length>0){t=!0;break}t&&f()})),n.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]})}function v(){chrome.storage.local.get("colorChanges",(e=>{((e.colorChanges||{})[y()]||[]).forEach((e=>{try{const t=p(e.fingerprint);if(t){const n=e.isGradient?`linear-gradient(${e.color})`:e.color;if(t.style.background=n,!t.getAttribute("data-ucolor-uid")){const e=l();t.setAttribute("data-ucolor-uid",e)}}}catch(e){console.warn("Failed to reapply style:",e)}}))}))}function b(o){if(!t)return;o.preventDefault(),o.stopPropagation(),e=o.target,document.querySelectorAll(".ucolor-hover").forEach((e=>e.classList.remove("ucolor-hover"))),e.classList.add("ucolor-selected");const r=s(e),c=m(e);if(!e.getAttribute("data-ucolor-uid")){const t=l();e.setAttribute("data-ucolor-uid",t)}chrome.runtime.sendMessage({type:"ELEMENT_SELECTED",elementInfo:{fingerprint:c,tagName:e.tagName,path:L(e),currentColor:r.color,isGradient:r.isGradient}}),t=!1,document.body.style.cursor="default",document.removeEventListener("mouseover",i),document.removeEventListener("mouseout",a),document.removeEventListener("click",b),n&&n.disconnect(),e&&e.classList.remove("ucolor-selected")}function L(e){const t=[];let n=e;for(;n&&n!==document.body;){let e=n.tagName.toLowerCase();n.id?e+="#"+n.id:n.className&&(e+="."+n.className.split(" ").filter((e=>"ucolor-hover"!==e)).join(".")),t.unshift(e),n=n.parentElement}return t.join(" > ")}const y=()=>window.location.origin+window.location.pathname;function E(e,t){const n=c[t.persistenceMode||"standard"];return h(t,e)>=n}chrome.runtime.onMessage.addListener(((n,o,c)=>{switch(n.type){case"START_PICKING":t=!0,document.body.style.cursor="crosshair",document.addEventListener("mouseover",i),document.addEventListener("mouseout",a),document.addEventListener("click",b),C(),c({success:!0});break;case"APPLY_COLOR":if(e&&n.color){let t=n.color;if(n.isGradient){const e=t.match(/(.*?)((?:rgb\([^)]+\)|#[a-fA-F0-9]{6}|[a-zA-Z]+))(.*?)((?:rgb\([^)]+\)|#[a-fA-F0-9]{6}|[a-zA-Z]+))(.*)/);if(e){const[,n,o,i,a,s]=e;t=`${n}${r(o)}${i}${r(a)}${s}`}}else t=r(n.color);e.style.background=n.isGradient?`linear-gradient(${t})`:t,e.setAttribute("data-ucolor-persistence",n.persistenceMode||"standard"),chrome.storage.local.get("colorChanges",(t=>{const o=t.colorChanges||{},r=y(),i=o[r]||[],a=m(e);a.persistenceMode=n.persistenceMode||"standard";const s={fingerprint:a,path:L(e),color:n.color,elementTag:e.tagName.toLowerCase(),timestamp:Date.now(),isGradient:n.isGradient},c=i.filter((t=>!E(e,t.fingerprint)));o[r]=[...c,s],chrome.storage.local.set({colorChanges:o})})),c({success:!0})}break;case"GET_SELECTED_ELEMENT":if(e){const t=s(e);c({hasSelected:!0,elementInfo:{tagName:e.tagName,path:L(e),currentColor:t.color,isGradient:t.isGradient}})}else c({hasSelected:!1,elementInfo:null});break;case"GET_HISTORY":chrome.storage.local.get("colorChanges",(e=>{const t=e.colorChanges||{},n=y();c({changes:t[n]||[]})}));break;case"RESET_ELEMENT":if(n.fingerprint){const e=p(n.fingerprint);e&&(e.style.background="",e.style.backgroundColor="",chrome.storage.local.get("colorChanges",(t=>{const n=t.colorChanges||{},o=y(),r=n[o]||[];n[o]=r.filter((t=>!E(e,t.fingerprint))),chrome.storage.local.set({colorChanges:n})}))),c({success:!0})}break;case"RESET_ALL":chrome.storage.local.get("colorChanges",(e=>{const t=e.colorChanges||{},n=y();(t[n]||[]).forEach((e=>{const t=document.querySelector(e.path);t&&(t.style.background="",t.style.backgroundColor="")})),delete t[n],chrome.storage.local.set({colorChanges:t}),c({success:!0})}))}return!0})),chrome.storage.local.get("colorChanges",(e=>{v(),C()}))})();